mutate(conc = rep(c(HighDose:LowDose), each=9, length.out = 270)) %>%
mutate(totaldist = "_totaldist") %>%
mutate(endpoint2 = paste(endpoint, totaldist)) %>%
select(
-is_VC,
-endpoint,
-dose,
-control_median,
-totaldist,
) %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
endpoint = endpoint2,
)
simi_prep <- simi_norm %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
) %>%
filter(is_VC == 0) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9)) %>%
select(-dose, -is_VC)
combined_data <- bind_rows(auc_prep, simi_prep)
View(combined_data)
data("combined_data")
out_curvep <- combi_run_rcurvep(combined_data, TRSH = 30)  # using Curvep with BMR = 30
out_fit <- run_fit(combined_data)
out_curvep <- combi_run_rcurvep(combined_data, TRSH = 30)  # using Curvep with BMR = 30
out_fit <- run_fit(combined_data)
View(out_curvep)
print(out_curvep)
View(out_curvep)
out_curvep[["result"]][["act_set"]][["POD"]]
?combi_run_rcurvep
out_bmr <- estimate_dataset_bmr(combined_data)
out_bmr <- estimate_dataset_bmr(out_curvep)
print(zfishdev_act)
View(out_fit)
out_curvep <- combi_run_rcurvep(combined_data, TRSH = 30, keep_sets = "act_set)  # using Curvep with BMR = 30
out_fit <- run_fit(combined_data)
out_curvep <- combi_run_rcurvep(combined_data, TRSH = 30, keep_sets = "act_set")  # using Curvep with BMR = 30
out_fit <- run_fit(combined_data)
out_curvep <- combi_run_rcurvep(combined_data, TRSH = 30, keep_sets = "act_set")  # using Curvep with BMR = 30
out_fit <- run_fit(combined_data)
out_bmr <- estimate_dataset_bmr(out_curvep)
?combi_run_rcurvep
out_curvep <- combi_run_rcurvep(combined_data, TRSH = 30, keep_sets = "act_set", n_samples = 1)  # using Curvep with BMR = 30
out_fit <- run_fit(combined_data)
out_bmr <- estimate_dataset_bmr(out_curvep)
write.table(combined_data, file = "combined_data_BPA")
write.table(combined_data, file = "combined_data_BPA.txt")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "/BPA/BPA.rds")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "*/BPA/BPA.rds")
write.table(auc_one, file = "/BPA/BPA_auc.txt")
?write.table
write.table(auc_one, file = "BPA/BPA_auc.txt")
write.table(simi_one[[1]], file = "BPA_simi.txt")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "BPA/BPA.rds")
remove(temp1)
patd <- readRDS("BPA.rds")
library(here)
library(tidyverse)
library(rlang)
library(Rcurvep)
source("cal_auc_simi_endpoints.R")
temp1 <- read.table("BPA.txt", header = TRUE)
saveRDS(temp1, file = "BPA/BPA.rds")
remove(temp1)
patd <- readRDS("BPA/BPA.rds")
patd_one <- patd %>%
filter(plate_id == "BPA")
auc_endps <- list(a = seq(1, 5, by = 1), b = seq(6, 10, by = 1), c = seq(11, 15, by = 1), d = seq(16, 20, by = 1), e = seq(21, 25, by = 1), f = seq(26, 30, by = 1) )
auc_one <- create_auc_endpoints(patd_one, segments = auc_endps)
auc_all <- create_auc_endpoints(patd, segments = auc_endps)
simi_endps <- list("ld_pearson" = seq(1, 20, by = 1))
simi_one <- create_simi_endpoints(patd_one, segments = simi_endps, metric = "pearson")
simi_all <- create_simi_endpoints(patd, segments = simi_endps, metric = "pearson")
write.table(auc_one, file = "BPA/BPA_auc.txt")
write.table(simi_one[[1]], file = "BPA/BPA_simi.txt")
auc_norm <- auc_one[[1]]
simi_norm <- simi_one[[1]]
auc_norm <- auc_norm %>%
mutate(endpoint_value_norm = log10(endpoint_value + 1)) %>%
select(-endpoint_value) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
auc_list <- split(auc_norm, auc_norm$endpoint)
for(i in 1:length(auc_list)) {
temp1 <- auc_list[[i]][1:9, 4] %>% unlist() %>% median()
auc_list[[i]]$control_median = temp1
remove(temp1)
}
auc_norm<- bind_rows(auc_list) %>%
mutate(endpoint_value_norm2  = (endpoint_value_norm - control_median)*100) %>%
select(-endpoint_value_norm) %>%
rename(endpoint_value_norm = endpoint_value_norm2)
auc_plot <- auc_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(auc_plot)
simi_norm <- simi_norm %>%
mutate(control_median = median(simi_norm[46:54, 5])) %>%
mutate(endpoint_value_norm = (endpoint_value/control_median)*100-100) %>%
select(-c(endpoint_value, control_median)) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
simi_plot <- simi_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(simi_plot)
write.table(auc_norm, file = "BPA/BPA_auc_norm.txt")
write.table(simi_norm, file = "BPA/BPA_simi_norm.txt")
#Concentrations (log10 ug/L)
HighDose <- 3
LowDose <- -1
auc_prep <- auc_norm %>%
filter(is_VC == FALSE) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9, length.out = 270)) %>%
mutate(totaldist = "_totaldist") %>%
mutate(endpoint2 = paste(endpoint, totaldist)) %>%
select(
-is_VC,
-endpoint,
-dose,
-control_median,
-totaldist,
) %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
endpoint = endpoint2,
)
simi_prep <- simi_norm %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
) %>%
filter(is_VC == 0) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9)) %>%
select(-dose, -is_VC)
combined_data <- bind_rows(auc_prep, simi_prep)
write.table(combined_data, file = "BPA/combined_data_BPA.txt")
library(here)
library(tidyverse)
library(rlang)
library(Rcurvep)
source("cal_auc_simi_endpoints.R")
temp1 <- read.table("BPAF.txt", header = TRUE)
saveRDS(temp1, file = "BPAF/BPAF.rds")
remove(temp1)
patd <- readRDS("BPAF/BPAF.rds")
temp1 <- read.table("BPAF.txt", header = TRUE)
saveRDS(temp1, file = "BPAF/BPAF.rds")
remove(temp1)
patd <- readRDS("BPAF/BPAF.rds")
patd <- patd %>%
unite(embryo_id, row_id, column_id) %>%
rename(
value = total_distance_moved,
is_VC = is_vehicle_control
) %>%
filter(
is.na(well_comment) #remove all malformed/dead
) %>%
select(plate_id, embryo_id, is_VC, time_end, value)
patd_one <- patd %>%
filter(plate_id == "BPAF")
auc_endps <- list(a = seq(1, 5, by = 1), b = seq(6, 10, by = 1), c = seq(11, 15, by = 1), d = seq(16, 20, by = 1), e = seq(21, 25, by = 1), f = seq(26, 30, by = 1) )
auc_one <- create_auc_endpoints(patd_one, segments = auc_endps)
auc_all <- create_auc_endpoints(patd, segments = auc_endps)
simi_endps <- list("ld_pearson" = seq(1, 20, by = 1))
simi_one <- create_simi_endpoints(patd_one, segments = simi_endps, metric = "pearson")
simi_all <- create_simi_endpoints(patd, segments = simi_endps, metric = "pearson")
write.table(auc_one, file = "BPAF/BPAF_auc.txt")
write.table(simi_one[[1]], file = "BPAF/BPAF_simi.txt")
auc_norm <- auc_one[[1]]
simi_norm <- simi_one[[1]]
auc_norm <- auc_norm %>%
mutate(endpoint_value_norm = log10(endpoint_value + 1)) %>%
select(-endpoint_value) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
auc_list <- split(auc_norm, auc_norm$endpoint)
for(i in 1:length(auc_list)) {
temp1 <- auc_list[[i]][1:9, 4] %>% unlist() %>% median()
auc_list[[i]]$control_median = temp1
remove(temp1)
}
auc_norm<- bind_rows(auc_list) %>%
mutate(endpoint_value_norm2  = (endpoint_value_norm - control_median)*100) %>%
select(-endpoint_value_norm) %>%
rename(endpoint_value_norm = endpoint_value_norm2)
auc_plot <- auc_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(auc_plot)
simi_norm <- simi_norm %>%
mutate(control_median = median(simi_norm[46:54, 5])) %>%
mutate(endpoint_value_norm = (endpoint_value/control_median)*100-100) %>%
select(-c(endpoint_value, control_median)) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
simi_plot <- simi_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(simi_plot)
write.table(auc_norm, file = "BPAF/BPAF_auc_norm.txt")
write.table(simi_norm, file = "BPAF/BPAF_simi_norm.txt")
#Concentrations (log10 ug/L)
HighDose <- 3
LowDose <- -1
auc_prep <- auc_norm %>%
filter(is_VC == FALSE) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9, length.out = 270)) %>%
mutate(totaldist = "_totaldist") %>%
mutate(endpoint2 = paste(endpoint, totaldist)) %>%
select(
-is_VC,
-endpoint,
-dose,
-control_median,
-totaldist,
) %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
endpoint = endpoint2,
)
simi_prep <- simi_norm %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
) %>%
filter(is_VC == 0) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9)) %>%
select(-dose, -is_VC)
combined_data <- bind_rows(auc_prep, simi_prep)
write.table(combined_data, file = "BPAF/combined_data_BPAF.txt")
library(here)
library(tidyverse)
library(rlang)
library(Rcurvep)
source("cal_auc_simi_endpoints.R")
temp1 <- read.table("DES.txt", header = TRUE)
saveRDS(temp1, file = "DES/DES.rds")
remove(temp1)
patd <- readRDS("DES/DES.rds")
temp1 <- read.table("DES.txt", header = TRUE)
saveRDS(temp1, file = "DES/DES.rds")
remove(temp1)
patd <- readRDS("DES/DES.rds")
library(here)
library(tidyverse)
library(rlang)
library(Rcurvep)
source("cal_auc_simi_endpoints.R")
temp1 <- read.table("DES.txt", header = TRUE)
saveRDS(temp1, file = "DES/DES.rds")
remove(temp1)
patd <- readRDS("DES/DES.rds")
patd_one <- patd %>%
filter(plate_id == "DES")
auc_endps <- list(a = seq(1, 5, by = 1), b = seq(6, 10, by = 1), c = seq(11, 15, by = 1), d = seq(16, 20, by = 1), e = seq(21, 25, by = 1), f = seq(26, 30, by = 1) )
auc_one <- create_auc_endpoints(patd_one, segments = auc_endps)
auc_all <- create_auc_endpoints(patd, segments = auc_endps)
simi_endps <- list("ld_pearson" = seq(1, 20, by = 1))
simi_one <- create_simi_endpoints(patd_one, segments = simi_endps, metric = "pearson")
simi_all <- create_simi_endpoints(patd, segments = simi_endps, metric = "pearson")
write.table(auc_one, file = "DES/DES_auc.txt")
write.table(simi_one[[1]], file = "DES/DES_simi.txt")
auc_norm <- auc_one[[1]]
simi_norm <- simi_one[[1]]
auc_norm <- auc_norm %>%
mutate(endpoint_value_norm = log10(endpoint_value + 1)) %>%
select(-endpoint_value) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
auc_list <- split(auc_norm, auc_norm$endpoint)
for(i in 1:length(auc_list)) {
temp1 <- auc_list[[i]][1:9, 4] %>% unlist() %>% median()
auc_list[[i]]$control_median = temp1
remove(temp1)
}
auc_norm<- bind_rows(auc_list) %>%
mutate(endpoint_value_norm2  = (endpoint_value_norm - control_median)*100) %>%
select(-endpoint_value_norm) %>%
rename(endpoint_value_norm = endpoint_value_norm2)
auc_plot <- auc_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(auc_plot)
simi_norm <- simi_norm %>%
mutate(control_median = median(simi_norm[46:54, 5])) %>%
mutate(endpoint_value_norm = (endpoint_value/control_median)*100-100) %>%
select(-c(endpoint_value, control_median)) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
simi_plot <- simi_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(simi_plot)
write.table(auc_norm, file = "DES/DES_auc_norm.txt")
write.table(simi_norm, file = "DES/DES_simi_norm.txt")
#Concentrations (log10 ug/L)
HighDose <- 3
LowDose <- -1
auc_prep <- auc_norm %>%
filter(is_VC == FALSE) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9, length.out = 270)) %>%
mutate(totaldist = "_totaldist") %>%
mutate(endpoint2 = paste(endpoint, totaldist)) %>%
select(
-is_VC,
-endpoint,
-dose,
-control_median,
-totaldist,
) %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
endpoint = endpoint2,
)
simi_prep <- simi_norm %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
) %>%
filter(is_VC == 0) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9)) %>%
select(-dose, -is_VC)
combined_data <- bind_rows(auc_prep, simi_prep)
library(here)
library(tidyverse)
library(rlang)
library(Rcurvep)
source("cal_auc_simi_endpoints.R")
temp1 <- read.table("EE2.txt", header = TRUE)
saveRDS(temp1, file = "EE2/EE2.rds")
remove(temp1)
patd <- readRDS("EE2/EE2.rds")
patd_one <- patd %>%
filter(plate_id == "EE2")
auc_endps <- list(a = seq(1, 5, by = 1), b = seq(6, 10, by = 1), c = seq(11, 15, by = 1), d = seq(16, 20, by = 1), e = seq(21, 25, by = 1), f = seq(26, 30, by = 1) )
auc_one <- create_auc_endpoints(patd_one, segments = auc_endps)
auc_all <- create_auc_endpoints(patd, segments = auc_endps)
simi_endps <- list("ld_pearson" = seq(1, 20, by = 1))
simi_one <- create_simi_endpoints(patd_one, segments = simi_endps, metric = "pearson")
simi_all <- create_simi_endpoints(patd, segments = simi_endps, metric = "pearson")
write.table(auc_one, file = "EE2/EE2_auc.txt")
write.table(simi_one[[1]], file = "EE2/EE2_simi.txt")
auc_norm <- auc_one[[1]]
simi_norm <- simi_one[[1]]
auc_norm <- auc_norm %>%
mutate(endpoint_value_norm = log10(endpoint_value + 1)) %>%
select(-endpoint_value) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
auc_list <- split(auc_norm, auc_norm$endpoint)
for(i in 1:length(auc_list)) {
temp1 <- auc_list[[i]][1:9, 4] %>% unlist() %>% median()
auc_list[[i]]$control_median = temp1
remove(temp1)
}
auc_norm<- bind_rows(auc_list) %>%
mutate(endpoint_value_norm2  = (endpoint_value_norm - control_median)*100) %>%
select(-endpoint_value_norm) %>%
rename(endpoint_value_norm = endpoint_value_norm2)
auc_plot <- auc_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(auc_plot)
simi_norm <- simi_norm %>%
mutate(control_median = median(simi_norm[46:54, 5])) %>%
mutate(endpoint_value_norm = (endpoint_value/control_median)*100-100) %>%
select(-c(endpoint_value, control_median)) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
simi_plot <- simi_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(simi_plot)
write.table(auc_norm, file = "EE2/EE2_auc_norm.txt")
write.table(simi_norm, file = "EE2/EE2_simi_norm.txt")
#Concentrations (log10 ug/L)
HighDose <- 3
LowDose <- -1
auc_prep <- auc_norm %>%
filter(is_VC == FALSE) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9, length.out = 270)) %>%
mutate(totaldist = "_totaldist") %>%
mutate(endpoint2 = paste(endpoint, totaldist)) %>%
select(
-is_VC,
-endpoint,
-dose,
-control_median,
-totaldist,
) %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
endpoint = endpoint2,
)
simi_prep <- simi_norm %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
) %>%
filter(is_VC == 0) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9)) %>%
select(-dose, -is_VC)
combined_data <- bind_rows(auc_prep, simi_prep)
library(here)
library(tidyverse)
library(rlang)
library(Rcurvep)
source("cal_auc_simi_endpoints.R")
temp1 <- read.table("TGSH.txt", header = TRUE)
saveRDS(temp1, file = "TGSH/TGSH.rds")
remove(temp1)
patd <- readRDS("TGSH/TGSH.rds")
patd_one <- patd %>%
filter(plate_id == "TGSH")
auc_endps <- list(a = seq(1, 5, by = 1), b = seq(6, 10, by = 1), c = seq(11, 15, by = 1), d = seq(16, 20, by = 1), e = seq(21, 25, by = 1), f = seq(26, 30, by = 1) )
auc_one <- create_auc_endpoints(patd_one, segments = auc_endps)
auc_all <- create_auc_endpoints(patd, segments = auc_endps)
simi_endps <- list("ld_pearson" = seq(1, 20, by = 1))
simi_one <- create_simi_endpoints(patd_one, segments = simi_endps, metric = "pearson")
simi_all <- create_simi_endpoints(patd, segments = simi_endps, metric = "pearson")
write.table(auc_one, file = "TGSH/TGSH_auc.txt")
write.table(simi_one[[1]], file = "TGSH/TGSH_simi.txt")
auc_norm <- auc_one[[1]]
simi_norm <- simi_one[[1]]
auc_norm <- auc_norm %>%
mutate(endpoint_value_norm = log10(endpoint_value + 1)) %>%
select(-endpoint_value) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
auc_list <- split(auc_norm, auc_norm$endpoint)
for(i in 1:length(auc_list)) {
temp1 <- auc_list[[i]][1:9, 4] %>% unlist() %>% median()
auc_list[[i]]$control_median = temp1
remove(temp1)
}
auc_norm<- bind_rows(auc_list) %>%
mutate(endpoint_value_norm2  = (endpoint_value_norm - control_median)*100) %>%
select(-endpoint_value_norm) %>%
rename(endpoint_value_norm = endpoint_value_norm2)
auc_plot <- auc_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(auc_plot)
simi_norm <- simi_norm %>%
mutate(control_median = median(simi_norm[46:54, 5])) %>%
mutate(endpoint_value_norm = (endpoint_value/control_median)*100-100) %>%
select(-c(endpoint_value, control_median)) %>%
mutate(dose = substr(embryo_id, 1, nchar(embryo_id)-2)) %>%
select(-embryo_id)
simi_plot <- simi_norm %>%
ggplot(aes(x = dose, y = endpoint_value_norm)) +
geom_boxplot()
print(simi_plot)
write.table(auc_norm, file = "TGSH/TGSH_auc_norm.txt")
write.table(simi_norm, file = "TGSH/TGSH_simi_norm.txt")
#Concentrations (log10 ug/L)
HighDose <- 3
LowDose <- -1
auc_prep <- auc_norm %>%
filter(is_VC == FALSE) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9, length.out = 270)) %>%
mutate(totaldist = "_totaldist") %>%
mutate(endpoint2 = paste(endpoint, totaldist)) %>%
select(
-is_VC,
-endpoint,
-dose,
-control_median,
-totaldist,
) %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
endpoint = endpoint2,
)
simi_prep <- simi_norm %>%
rename(
resp = endpoint_value_norm,
chemical = plate_id,
) %>%
filter(is_VC == 0) %>%
mutate(conc = rep(c(HighDose:LowDose), each=9)) %>%
select(-dose, -is_VC)
combined_data <- bind_rows(auc_prep, simi_prep)
